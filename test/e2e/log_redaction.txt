===
make request with secret query param (issue #85)
===
curl -s -o /dev/null "http://localhost:8686/sandbox-health?secret=supersecretvalue123&other=visible"
echo "request sent"
---
request sent

===
verify secret value is NOT in logs (issue #85)
%require
===
if grep -q "supersecretvalue123" "$CCTR_FIXTURE_DIR/wrangler.log"; then
  echo "FAIL: secret value found in logs"
  grep "supersecretvalue123" "$CCTR_FIXTURE_DIR/wrangler.log"
  exit 1
else
  echo "PASS: secret value not found in logs"
fi
---
PASS: secret value not found in logs

===
verify REDACTED placeholder IS in logs (issue #85)
===
# The [REDACTED] value appears URL-encoded in logs as %5BREDACTED%5D
if grep -qE "(\[REDACTED\]|%5BREDACTED%5D)" "$CCTR_FIXTURE_DIR/wrangler.log"; then
  echo "PASS: [REDACTED] found in logs"
else
  echo "FAIL: [REDACTED] not found in logs"
  grep -i redact "$CCTR_FIXTURE_DIR/wrangler.log" || echo "(no redact matches)"
  exit 1
fi
---
PASS: [REDACTED] found in logs

===
verify gateway token value is NOT in request logs
===
TOKEN=$(cat "$CCTR_FIXTURE_DIR/gateway-token.txt")
# Check specifically in [REQ] lines - the token appears elsewhere (e.g. config output)
if grep "\[REQ\]" "$CCTR_FIXTURE_DIR/wrangler.log" | grep -q "$TOKEN"; then
  echo "FAIL: gateway token found in [REQ] logs"
  grep "\[REQ\].*$TOKEN" "$CCTR_FIXTURE_DIR/wrangler.log"
  exit 1
else
  echo "PASS: gateway token not found in [REQ] logs"
fi
---
PASS: gateway token not found in [REQ] logs
